#!/bin/bash
# Lets see machine specifications and environments
df -h
free -h

curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null
apt update && apt install wget pigz gh

cd /tmp # Where to download cccahe

echo "|| Downloading CCACHE ||"
#time wget https://polished-disk-a3d6.shubhamxd.workers.dev/0:/ccache_backup.zip.001
#time wget https://polished-disk-a3d6.shubhamxd.workers.dev/0:/ccache_backup.zip.002
#time wget https://polished-disk-a3d6.shubhamxd.workers.dev/0:/ccache_backup.zip.003

# Extract ccache so ci can use it
echo " Extracting CCACHE "
if [ -e *.zip.001 ]; then
7za x *.zip.001
fi
if [ -e *.tar.gz ]; then
time tar xf *.tar.gz
fi

# Remove unnecessary downloaded file
rm -rf *.tar.gz
rm -rf *.zip.*

# fix
echo "" > /etc/mtab
